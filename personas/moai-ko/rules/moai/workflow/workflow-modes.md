# 워크플로우 모드

MoAI-ADK SPEC 워크플로우를 위한 개발 방법론 참조.

단계 개요, 토큰 전략 및 전환에 대해서는 @spec-workflow.md 참조

## 방법론 선택

Run 단계는 `.moai/config/sections/quality.yaml`의 `quality.development_mode`에 따라 워크플로우를 조정합니다:

| 모드 | 워크플로우 사이클 | 적합한 경우 | 에이전트 전략 |
|------|---------------|----------|----------------|
| DDD | ANALYZE-PRESERVE-IMPROVE | 기존 프로젝트, 커버리지 < 10% | 특성화 테스트 먼저 |
| TDD | RED-GREEN-REFACTOR | 새 프로젝트, 커버리지 50%+ | 구현 전 테스트 |
| Hybrid | 변경 유형별 혼합 | 부분 커버리지 (10-49%) | 새 코드: TDD, 레거시: DDD |

## DDD 모드 (기본값)

개발 방법론: 도메인 주도 개발 (ANALYZE-PRESERVE-IMPROVE)

**ANALYZE**: 기존 동작 및 코드 구조 이해
- 기존 코드를 읽고 의존성 파악
- 도메인 경계 및 상호작용 패턴 매핑
- 사이드이펙트 및 암묵적 계약 식별

**PRESERVE**: 기존 동작에 대한 특성화 테스트 생성
- 현재 동작을 포착하는 특성화 테스트 작성
- 회귀 감지를 위한 동작 스냅샷 생성
- 핵심 경로의 테스트 커버리지 확인

**IMPROVE**: 동작 보존을 유지하며 변경사항 구현
- 작고 점진적인 변경 수행
- 각 변경 후 특성화 테스트 실행
- 테스트 검증을 통한 리팩토링

성공 기준:
- 모든 SPEC 요구사항 구현 완료
- 특성화 테스트 통과
- 동작 스냅샷 안정 (회귀 없음)
- 85%+ 코드 커버리지 달성
- TRUST 5 품질 게이트 통과

## TDD 모드

개발 방법론: 테스트 주도 개발 (RED-GREEN-REFACTOR)

**RED**: 실패하는 테스트 작성
- 원하는 동작을 설명하는 테스트 작성
- 테스트가 실패하는지 확인 (새로운 것을 테스트함을 확인)
- 한 번에 하나의 테스트, 집중적이고 구체적으로

**GREEN**: 통과하는 최소한의 코드 작성
- 테스트를 통과시키는 가장 단순한 구현 작성
- 조기 최적화나 추상화 금지
- 우아함이 아닌 정확성에 집중

**REFACTOR**: 코드 품질 개선
- 테스트를 통과시키면서 구현 정리
- 패턴 추출, 중복 제거
- 적절한 경우 SOLID 원칙 적용

성공 기준:
- 모든 SPEC 요구사항 구현 완료
- 모든 테스트 통과 (RED-GREEN-REFACTOR 완료)
- 커밋당 최소 커버리지: 80% (설정 가능)
- 구현 코드 이후에 테스트 작성 금지
- TRUST 5 품질 게이트 통과

## Hybrid 모드

개발 방법론: Hybrid (새 코드는 TDD + 레거시는 DDD)

**새 코드의 경우** (새 파일, 새 함수):
- TDD 워크플로우 적용 (RED-GREEN-REFACTOR)
- 엄격한 테스트 우선 요건
- 커버리지 목표: 새 코드의 85%

**기존 코드의 경우** (수정, 리팩토링):
- DDD 워크플로우 적용 (ANALYZE-PRESERVE-IMPROVE)
- 변경 전 특성화 테스트
- 커버리지 목표: 수정된 코드의 85%

**분류 논리**:
- 새 파일 - TDD 규칙
- 수정된 기존 파일 - DDD 규칙
- 기존 파일의 새 함수 - 해당 함수에 TDD 규칙
- 삭제된 코드 - 특성화 테스트가 여전히 통과하는지 확인

성공 기준:
- 모든 SPEC 요구사항 구현 완료
- 새 코드의 TDD 수준 커버리지 (85%+)
- 수정된 코드에 특성화 테스트 존재
- 전반적인 커버리지 개선 추세
- TRUST 5 품질 게이트 통과

## 방법론 선택 가이드

### 자동 감지 (/moai project 또는 /moai init을 통해)

시스템이 프로젝트 분석을 기반으로 방법론을 자동 추천합니다:

| 프로젝트 상태 | 테스트 커버리지 | 권장 | 근거 |
|--------------|---------------|----------------|-----------|
| Greenfield (새 프로젝트) | N/A | Hybrid | 깨끗한 시작점, 기능은 TDD + DDD 구조 |
| Brownfield | >= 50% | TDD | 테스트 우선 개발을 위한 충분한 테스트 기반 |
| Brownfield | 10-49% | Hybrid | 부분적 테스트, DDD로 확장 후 새 코드는 TDD |
| Brownfield | < 10% | DDD | 테스트 없음, 점진적인 특성화 테스트 생성 |

### 수동 재정의

사용자가 자동 감지된 방법론을 재정의할 수 있습니다:
- 초기화 중: 마법사에서 선택하거나 `--development-mode` 플래그 사용
- 초기화 후: `.moai/config/sections/quality.yaml`의 `quality.development_mode` 편집
- 세션별: `MOAI_DEVELOPMENT_MODE` 환경변수 설정

### 방법론 비교

| 측면 | DDD | TDD | Hybrid |
|--------|-----|-----|--------|
| 테스트 시점 | 분석 후 (PRESERVE) | 코드 전 (RED) | 혼합 |
| 커버리지 접근 | 점진적 개선 | 커밋별 엄격 | 통합 85% 목표 |
| 적합한 경우 | 레거시 리팩토링만 | 독립 모듈 (드물게) | 모든 개발 작업 |
| 위험 수준 | 낮음 (동작 보존) | 중간 (규율 필요) | 중간 |
| 커버리지 면제 | 허용 | 허용 안 됨 | 레거시만 허용 |
| Run 단계 사이클 | ANALYZE-PRESERVE-IMPROVE | RED-GREEN-REFACTOR | 둘 다 (변경 유형별) |
